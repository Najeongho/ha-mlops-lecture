# Lab 3-2: E2E Pipeline í†µí•©

## ğŸ“‹ ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì†Œìš”ì‹œê°„** | 60ë¶„ |
| **ë‚œì´ë„** | â­â­â­ |
| **ëª©í‘œ** | ë°ì´í„° ë¡œë“œë¶€í„° ëª¨ë¸ ë°°í¬ê¹Œì§€ ì™„ì „ ìë™í™” íŒŒì´í”„ë¼ì¸ êµ¬ì¶• |

## ğŸ¯ í•™ìŠµ ëª©í‘œ

- ë‹¤ë‹¨ê³„ íŒŒì´í”„ë¼ì¸ êµ¬ì„±
- MLflow í†µí•©
- KServe ìë™ ë°°í¬
- ì¡°ê±´ ë¶„ê¸° ì ìš©

## ğŸ—ï¸ íŒŒì´í”„ë¼ì¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    E2E ML Pipeline                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Load   â”‚â”€â”€â–¶â”‚  Pre-   â”‚â”€â”€â–¶â”‚  Train  â”‚â”€â”€â–¶â”‚  Evaluate   â”‚ â”‚
â”‚  â”‚  Data   â”‚   â”‚ process â”‚   â”‚  Model  â”‚   â”‚             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚             â”‚             â”‚               â”‚         â”‚
â”‚       â–¼             â–¼             â–¼               â”‚         â”‚
â”‚     [S3]          [S3]       [MLflow]             â”‚         â”‚
â”‚                                                   â”‚         â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”   â”‚
â”‚                              â”‚    Condition: R2 > 0.8   â”‚   â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚            â”‚         â”‚
â”‚                                    Yes           No         â”‚
â”‚                                      â–¼            â–¼         â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                              â”‚   Deploy    â”‚ â”‚  Alert   â”‚   â”‚
â”‚                              â”‚  (KServe)   â”‚ â”‚          â”‚   â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
lab3-2_e2e-pipeline/
â”œâ”€â”€ README.md
â”œâ”€â”€ e2e_pipeline.py              # ì „ì²´ íŒŒì´í”„ë¼ì¸ ì½”ë“œ
â”œâ”€â”€ e2e_pipeline.ipynb           # Jupyter Notebook ë²„ì „
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ data_loader.py           # ë°ì´í„° ë¡œë“œ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ preprocessor.py          # ì „ì²˜ë¦¬ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ trainer.py               # í•™ìŠµ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ evaluator.py             # í‰ê°€ ì»´í¬ë„ŒíŠ¸
â”‚   â””â”€â”€ deployer.py              # ë°°í¬ ì»´í¬ë„ŒíŠ¸
â””â”€â”€ run_pipeline.sh              # ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
```

## ğŸ”§ ì‹¤ìŠµ ë‹¨ê³„

### Step 1: ì»´í¬ë„ŒíŠ¸ ì´í•´

ê° ì»´í¬ë„ŒíŠ¸ì˜ ì—­í• :

| ì»´í¬ë„ŒíŠ¸ | ì…ë ¥ | ì¶œë ¥ | ì—­í•  |
|----------|------|------|------|
| load_data | S3 ê²½ë¡œ | ë°ì´í„° ê²½ë¡œ | ë°ì´í„° ë‹¤ìš´ë¡œë“œ |
| preprocess | ë°ì´í„° ê²½ë¡œ | ì „ì²˜ë¦¬ ë°ì´í„° | ì •ê·œí™”, ê²°ì¸¡ì¹˜ ì²˜ë¦¬ |
| train_model | ë°ì´í„°, MLflow URI | Run ID | í•™ìŠµ + MLflow ê¸°ë¡ |
| evaluate | Run ID | R2 ì ìˆ˜ | ëª¨ë¸ í‰ê°€ |
| deploy | Run ID, ë„¤ì„ìŠ¤í˜ì´ìŠ¤ | - | KServe ë°°í¬ |

### Step 2: íŒŒì´í”„ë¼ì¸ ì‹¤í–‰

```bash
# Notebookì—ì„œ ì‹¤í–‰
python e2e_pipeline.py

# ë˜ëŠ” Jupyterì—ì„œ ì‹¤í–‰
```

### Step 3: ê²°ê³¼ í™•ì¸

1. **Kubeflow UI** â†’ Runs â†’ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ í™•ì¸
2. **MLflow UI** â†’ Experiments â†’ ì‹¤í—˜ ê²°ê³¼ í™•ì¸
3. **kubectl** â†’ InferenceService ìƒíƒœ í™•ì¸

## âœ… ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ëª¨ë“  ì»´í¬ë„ŒíŠ¸ ì •ì˜
- [ ] íŒŒì´í”„ë¼ì¸ ì»´íŒŒì¼ ì„±ê³µ
- [ ] íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ (Succeeded)
- [ ] MLflowì— ì‹¤í—˜ ê¸°ë¡ë¨
- [ ] (ì¡°ê±´ ì¶©ì¡± ì‹œ) KServe ë°°í¬ë¨

## ğŸ“Š ì»´í¬ë„ŒíŠ¸ ì½”ë“œ êµ¬ì¡°

```python
@create_component_from_func
def component_name(
    input_param: str,       # ì…ë ¥
    config: dict = {}       # ì„¤ì •
) -> str:                   # ì¶œë ¥
    """ì»´í¬ë„ŒíŠ¸ ì„¤ëª…"""
    
    # 1. Import (í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ!)
    import pandas as pd
    
    # 2. ë¡œì§ ìˆ˜í–‰
    result = process(input_param)
    
    # 3. ê²°ê³¼ ë°˜í™˜
    return result
```

## â“ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ: ì»´í¬ë„ŒíŠ¸ ê°„ ë°ì´í„° ì „ë‹¬ ì‹¤íŒ¨

```python
# ì˜¬ë°”ë¥¸ ë°©ë²•: .output ì‚¬ìš©
step2 = component_b(input=step1.output)

# ì˜ëª»ëœ ë°©ë²•
step2 = component_b(input=step1)  # âŒ
```

### ë¬¸ì œ: MLflow ì—°ê²° ì‹¤íŒ¨

```python
# í™˜ê²½ ë³€ìˆ˜ í™•ì¸
import os
os.environ['MLFLOW_TRACKING_URI'] = 'http://...'
```

### ë¬¸ì œ: KServe ë°°í¬ ì‹¤íŒ¨

```bash
# RBAC ê¶Œí•œ í™•ì¸
kubectl auth can-i create inferenceservices -n kubeflow-userXX
```

## ğŸ“š ì°¸ê³  ìë£Œ

- [Kubeflow Pipelines ì»´í¬ë„ŒíŠ¸](https://www.kubeflow.org/docs/components/pipelines/sdk/component-development/)
- [MLflow Model Deployment](https://mlflow.org/docs/latest/models.html)
- [KServe Python SDK](https://kserve.github.io/website/0.10/sdk_docs/sdk_doc/)
