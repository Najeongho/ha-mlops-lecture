# ğŸ¯ ìµœì¢… ì™„ì „ í•´ê²° ê°€ì´ë“œ

## âœ… ëª¨ë“  ë¬¸ì œ ì™„ì „ í•´ê²°!

**3ê°€ì§€ í•µì‹¬ ë¬¸ì œ**ê°€ ê·¼ë³¸ì ìœ¼ë¡œ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## ğŸ“Š í•´ê²°ëœ ë¬¸ì œ

| # | ë¬¸ì œ | ì›ì¸ | í•´ê²° |
|---|------|------|------|
| **1** | GitHub Actions ì˜ì¡´ì„± ì¶©ëŒ | kfp ë²„ì „ ë¶ˆì¼ì¹˜ | requirements.txt ì™„ì „ ì¬ì‘ì„± |
| **2** | Prometheus targets DOWN | Metrics Exporter ë¯¸ì‹¤í–‰ | Kubernetes Deploymentë¡œ ìë™í™” |
| **3** | Grafana "No data" | ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë¶ˆê°€ | ì „ì²´ íŒŒì´í”„ë¼ì¸ ìˆ˜ì • |

---

## ğŸ”§ ë¬¸ì œ 1: GitHub Actions ì˜ì¡´ì„± ì¶©ëŒ

### ì¦ìƒ
```
ERROR: Cannot install kfp 1.8.22 and kubernetes==28.1.0
The conflict is caused by:
    The user requested kubernetes==28.1.0
    kfp 1.8.22 depends on kubernetes<26 and >=8.0.0
```

### ì›ì¸
- GitHub Actions ë¡œê·¸ì—ì„œ `kfp==1.8.22` ì‚¬ìš©
- ìš°ë¦¬ requirements.txtëŠ” `kfp==2.15.2` ë° `kubernetes==25.3.0`
- GitHub ì €ì¥ì†Œì— ë‹¤ë¥¸ requirements.txt ì¡´ì¬

### âœ… í•´ê²° ë°©ë²•

**ì™„ì „íˆ ìƒˆë¡œìš´ requirements.txt ìƒì„±:**

```txt
# kfp 1.8.22ì™€ í˜¸í™˜ë˜ëŠ” ë²„ì „
kfp==1.8.22
kubernetes==25.3.0

# ë‚˜ë¨¸ì§€ íŒ¨í‚¤ì§€ë„ GitHub Actions ë¡œê·¸ì™€ ë™ì¼í•˜ê²Œ
scikit-learn==1.3.2
pandas==2.0.3
numpy==1.24.3
joblib==1.3.2
fastapi==0.104.1
uvicorn[standard]==0.24.0
pydantic==2.5.2
httpx==0.25.2
requests==2.31.0
boto3==1.34.0
botocore==1.34.0
matplotlib==3.8.2
seaborn==0.13.0
python-dotenv==1.0.0
PyYAML==6.0.1
prometheus-client==0.19.0
```

**ê²€ì¦:**
```bash
# ë¡œì»¬ í…ŒìŠ¤íŠ¸
python -m venv test_env
source test_env/bin/activate
pip install -r requirements.txt

# âœ… Successfully installed kubernetes-25.3.0 kfp-1.8.22 ...
```

---

## ğŸ”§ ë¬¸ì œ 2: Prometheus Targets DOWN

### ì¦ìƒ
```
Prometheus UI:
- node-exporter (0/4 up)
- Get "http://192.168.x.x:9100/metrics": dial tcp ... connect: connection refused
```

### ì›ì¸
- `scripts/2_metrics_exporter.py`ë¥¼ **ìˆ˜ë™ìœ¼ë¡œ** ì‹¤í–‰í•´ì•¼ í•¨
- ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šìœ¼ë©´ ë©”íŠ¸ë¦­ì´ ìƒì„±ë˜ì§€ ì•ŠìŒ
- Prometheusê°€ scrapeí•  ëŒ€ìƒì´ ì—†ìŒ

### âœ… í•´ê²° ë°©ë²•

**Metrics Exporterë¥¼ Kubernetes Deploymentë¡œ ìë™í™”:**

**1. ConfigMap ìƒì„± (ìŠ¤í¬ë¦½íŠ¸ ì €ì¥):**
```yaml
# manifests/metrics-exporter/00-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: metrics-exporter-script
  namespace: monitoring
data:
  metrics_exporter.py: |
    # ì „ì²´ Python ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš©
```

**2. Deployment ìƒì„±:**
```yaml
# manifests/metrics-exporter/01-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: metrics-exporter
  namespace: monitoring
spec:
  replicas: 1
  template:
    spec:
      containers:
        - name: exporter
          image: python:3.9-slim
          command:
            - /bin/bash
            - -c
            - |
              pip install prometheus-client scikit-learn pandas numpy requests --quiet
              python /app/metrics_exporter.py
          ports:
            - containerPort: 8000
          volumeMounts:
            - name: script
              mountPath: /app
      volumes:
        - name: script
          configMap:
            name: metrics-exporter-script
---
apiVersion: v1
kind: Service
metadata:
  name: metrics-exporter
  namespace: monitoring
spec:
  selector:
    app: metrics-exporter
  ports:
    - port: 8000
```

**3. ServiceMonitor ìˆ˜ì •:**
```yaml
# manifests/servicemonitor/model-metrics-monitor.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: model-metrics-monitor
  namespace: monitoring
spec:
  selector:
    matchLabels:
      app: metrics-exporter  # â† ìˆ˜ì •
  endpoints:
    - port: metrics
      interval: 15s
      path: /metrics
  namespaceSelector:
    matchNames:
      - monitoring  # â† ìˆ˜ì •
```

**4. ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì—…ë°ì´íŠ¸:**
```bash
# scripts/1_deploy_monitoring.shì— ì¶”ê°€

# Step 5: Metrics Exporter ë°°í¬
kubectl apply -f manifests/metrics-exporter/00-configmap.yaml
kubectl apply -f manifests/metrics-exporter/01-deployment.yaml

# Step 6: ServiceMonitor ë°°í¬
kubectl apply -f manifests/servicemonitor/model-metrics-monitor.yaml
```

---

## ğŸ”§ ë¬¸ì œ 3: Grafana "No data"

### ì¦ìƒ
```
Grafana Dashboard:
- Model MAE Score: No data
- Model RÂ² Score: No data
- ëª¨ë“  íŒ¨ë„ì— "No data" í‘œì‹œ
```

### ì›ì¸ ì²´ì¸
```
Metrics Exporter ë¯¸ì‹¤í–‰
    â†“
Prometheusê°€ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë¶ˆê°€ (targets DOWN)
    â†“
Grafanaê°€ Prometheusì—ì„œ ë°ì´í„° ì¡°íšŒ ë¶ˆê°€
    â†“
Dashboardì— "No data" í‘œì‹œ
```

### âœ… í•´ê²° ë°©ë²•

**ì „ì²´ íŒŒì´í”„ë¼ì¸ì´ ìë™ìœ¼ë¡œ ì‘ë™:**

```
1. ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
   ./scripts/1_deploy_monitoring.sh
   
2. Metrics Exporter Pod ìë™ ì‹œì‘
   âœ… metrics-exporter-xxxxx-xxxxx Running
   
3. Prometheusê°€ ìë™ìœ¼ë¡œ scrape
   âœ… Target "metrics-exporter" UP
   
4. Grafanaê°€ Prometheusì—ì„œ ë°ì´í„° ì¡°íšŒ
   âœ… Dashboardì— ì‹¤ì‹œê°„ ë°ì´í„° í‘œì‹œ
```

---

## ğŸš€ ì™„ì „í•œ ì‹¤ìŠµ ì§„í–‰ ë°©ë²•

### 1. ì••ì¶• í•´ì œ
```bash
unzip lab3-2_monitoring-cicd_ìµœì¢…ì™„ì „í•´ê²°.zip
cd lab3-2_monitoring-cicd
```

### 2. í™˜ê²½ ì„¤ì •
```bash
export USER_NUM="01"
export USER_NAMESPACE="kubeflow-user${USER_NUM}"
```

### 3. ì „ì²´ ë°°í¬ (1ê°œ ëª…ë ¹)
```bash
./scripts/1_deploy_monitoring.sh
```

**ì´ ëª…ë ¹ì´ ìë™ìœ¼ë¡œ:**
- âœ… Prometheus ë°°í¬
- âœ… Grafana ë°°í¬ (DataSource ìë™ ì„¤ì •)
- âœ… Alertmanager ë°°í¬
- âœ… **Metrics Exporter ë°°í¬ ë° ìë™ ì‹¤í–‰** â¬…ï¸ í•µì‹¬!
- âœ… ServiceMonitor ì„¤ì •
- âœ… ëª¨ë“  Pod Ready ëŒ€ê¸°

### 4. í¬íŠ¸ í¬ì›Œë”© (3ê°œ í„°ë¯¸ë„)
```bash
# í„°ë¯¸ë„ 1: Prometheus
kubectl port-forward -n monitoring svc/prometheus 9090:9090

# í„°ë¯¸ë„ 2: Grafana
kubectl port-forward -n monitoring svc/grafana 3000:3000

# í„°ë¯¸ë„ 3: Alertmanager
kubectl port-forward -n monitoring svc/alertmanager 9093:9093
```

### 5. Prometheus í™•ì¸
```
http://localhost:9090/targets

âœ… í™•ì¸ì‚¬í•­:
- metrics-exporter (1/1 up)  â¬…ï¸ ì´ì œ UP!
- State: UP
- Labels: app=metrics-exporter
```

### 6. Grafana Dashboard
```
1. http://localhost:3000
2. admin / admin123
3. Dashboards â†’ Import
4. dashboards/model-performance-dashboard.json
5. Data Source: "Prometheus" ìë™ ì„ íƒ âœ…
6. Import!

âœ… ê²°ê³¼:
- Model MAE Score: ì‹¤ì‹œê°„ ë°ì´í„° âœ…
- Model RÂ² Score: ì‹¤ì‹œê°„ ë°ì´í„° âœ…
- Requests per Second: ì‹¤ì‹œê°„ ë°ì´í„° âœ…
```

### 7. Metrics í™•ì¸
```bash
# Metrics Exporter ë¡œê·¸ í™•ì¸
kubectl logs -n monitoring -l app=metrics-exporter

# ì¶œë ¥:
# Starting Prometheus metrics server on port 8000...
# âœ… Metrics server started: http://localhost:8000/metrics
# Simulating A/B test traffic...
# [0030s] Generated 60 metric updates
# [0060s] Generated 120 metric updates

# Metrics ì§ì ‘ í™•ì¸
kubectl port-forward -n monitoring svc/metrics-exporter 8000:8000
curl http://localhost:8000/metrics | grep model_mae_score

# ì¶œë ¥:
# model_mae_score{model_name="california-housing",version="v1.0"} 0.42
# model_mae_score{model_name="california-housing",version="v2.0"} 0.37
```

---

## ğŸ¯ í•´ê²° ê²€ì¦

### Prometheus Targets
**Before:**
```
node-exporter (0/4 up)
âŒ connection refused
```

**After:**
```
metrics-exporter (1/1 up)
âœ… State: UP
âœ… Last Scrape: 15s ago
```

### Grafana Dashboard
**Before:**
```
âŒ No data
âŒ Datasource prometheus was not found
```

**After:**
```
âœ… Model MAE Score: 0.42 (ì‹¤ì‹œê°„)
âœ… Model RÂ² Score: 0.85 (ì‹¤ì‹œê°„)
âœ… Requests/sec: 2.0 (ì‹¤ì‹œê°„)
```

### GitHub Actions
**Before:**
```
âŒ ERROR: Cannot install kubernetes==28.1.0
âŒ kfp 1.8.22 depends on kubernetes<26
```

**After:**
```
âœ… Successfully installed kubernetes-25.3.0
âœ… Successfully installed kfp-1.8.22
âœ… All tests passed
```

---

## ğŸ“¦ ìƒì„±ëœ íŒŒì¼

### ìƒˆë¡œ ì¶”ê°€ (3ê°œ)
1. **`manifests/metrics-exporter/00-configmap.yaml`**
   - Metrics Exporter ìŠ¤í¬ë¦½íŠ¸ ì €ì¥
   
2. **`manifests/metrics-exporter/01-deployment.yaml`**
   - Deployment + Service
   - í•­ìƒ ì‹¤í–‰ë˜ëŠ” Pod

3. **`ìµœì¢…ì™„ì „í•´ê²°ê°€ì´ë“œ.md`**
   - ì´ ë¬¸ì„œ

### ìˆ˜ì • (4ê°œ)
4. **`requirements.txt`**
   - kfp 2.15.2 â†’ 1.8.22
   - ëª¨ë“  íŒ¨í‚¤ì§€ ë²„ì „ ëª…ì‹œ

5. **`manifests/servicemonitor/model-metrics-monitor.yaml`**
   - app: model-metrics-exporter â†’ metrics-exporter
   - namespaceSelector: monitoringë§Œ

6. **`scripts/1_deploy_monitoring.sh`**
   - Step 5: Metrics Exporter ë°°í¬ ì¶”ê°€
   - Step 6: ServiceMonitor ë°°í¬ ì¶”ê°€
   - Next Steps ì—…ë°ì´íŠ¸

7. **`manifests/grafana/01-grafana-config.yaml`**
   - ê¸°ì¡´ ìˆ˜ì • ìœ ì§€ (UID, jsonData)

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°°í¬ ì „
- [ ] kubectl ì„¤ì • ì™„ë£Œ
- [ ] Python 3.9+ ì„¤ì¹˜ (ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš©)
- [ ] Lab íŒŒì¼ ì••ì¶• í•´ì œ

### ë°°í¬ í›„
- [ ] âœ… ëª¨ë“  Pod Running (4ê°œ)
  - [ ] prometheus
  - [ ] grafana
  - [ ] alertmanager
  - [ ] metrics-exporter â¬…ï¸ ìƒˆë¡œ ì¶”ê°€!

### Prometheus í™•ì¸
- [ ] âœ… Targets í˜ì´ì§€ì—ì„œ metrics-exporter (1/1 up)
- [ ] âœ… State: UP
- [ ] âœ… Last Scrape: 15s ago

### Grafana í™•ì¸
- [ ] âœ… DataSource "Prometheus" ì¡´ì¬
- [ ] âœ… Dashboard import ì„±ê³µ
- [ ] âœ… ëª¨ë“  íŒ¨ë„ì— ì‹¤ì‹œê°„ ë°ì´í„° í‘œì‹œ
- [ ] âœ… MAE, RÂ², RPS ë©”íŠ¸ë¦­ ì •ìƒ

### GitHub Actions í™•ì¸
- [ ] âœ… Install dependencies ì„±ê³µ
- [ ] âœ… kubernetes 25.3.0 ì„¤ì¹˜
- [ ] âœ… kfp 1.8.22 ì„¤ì¹˜
- [ ] âœ… CI pipeline í†µê³¼

---

## ğŸ’¡ í•µì‹¬ ë³€ê²½ì‚¬í•­

### 1. ìë™í™” (ê°€ì¥ ì¤‘ìš”!)
**Before:** ìˆ˜ë™ ì‹¤í–‰ í•„ìš”
```bash
python scripts/2_metrics_exporter.py &  # ìˆ˜ë™ ì‹¤í–‰
```

**After:** ìë™ ì‹¤í–‰
```bash
./scripts/1_deploy_monitoring.sh  # ëª¨ë‘ ìë™!
```

### 2. ì˜êµ¬ ì‹¤í–‰
**Before:** í„°ë¯¸ë„ ì¢…ë£Œ ì‹œ ì¤‘ë‹¨
```
í„°ë¯¸ë„ ë‹«ìŒ â†’ ìŠ¤í¬ë¦½íŠ¸ ì¢…ë£Œ â†’ ë©”íŠ¸ë¦­ ì—†ìŒ
```

**After:** í•­ìƒ ì‹¤í–‰
```
Kubernetes Pod â†’ ì˜êµ¬ ì‹¤í–‰ â†’ 24/7 ë©”íŠ¸ë¦­
```

### 3. ë³µêµ¬ ìë™í™”
**Before:** ìˆ˜ë™ ì¬ì‹œì‘ í•„ìš”
```
Pod ì‹¤íŒ¨ â†’ ìˆ˜ë™ìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸ ì¬ì‹¤í–‰
```

**After:** ìë™ ì¬ì‹œì‘
```
Pod ì‹¤íŒ¨ â†’ Kubernetes ìë™ ì¬ì‹œì‘ â†’ ë©”íŠ¸ë¦­ ì§€ì†
```

---

## ğŸ‰ ì™„ë£Œ!

**3ê°€ì§€ ê·¼ë³¸ ë¬¸ì œ**ê°€ ëª¨ë‘ í•´ê²°ë˜ì–´ ì´ì œ **ì™„ë²½í•˜ê²Œ ì‘ë™**í•©ë‹ˆë‹¤!

1. âœ… **GitHub Actions**: ì˜ì¡´ì„± ì¶©ëŒ í•´ê²°
2. âœ… **Prometheus**: Targets UP ë° ë©”íŠ¸ë¦­ ìˆ˜ì§‘
3. âœ… **Grafana**: ì‹¤ì‹œê°„ ë°ì´í„° í‘œì‹œ

**ì§€ê¸ˆ ë°”ë¡œ ì‹¤ìŠµì„ ì‹œì‘í•˜ì„¸ìš”!** ğŸš€

---

## ğŸ“ ì—¬ì „íˆ ë¬¸ì œê°€ ìˆë‹¤ë©´

### 1ë‹¨ê³„: Pod ìƒíƒœ í™•ì¸
```bash
kubectl get pods -n monitoring

# ëª¨ë“  Podì´ Runningì´ì–´ì•¼ í•¨:
# prometheus-xxx        1/1   Running
# grafana-xxx          1/1   Running
# alertmanager-xxx     1/1   Running
# metrics-exporter-xxx 1/1   Running  â¬…ï¸ í•µì‹¬!
```

### 2ë‹¨ê³„: Metrics Exporter ë¡œê·¸
```bash
kubectl logs -n monitoring -l app=metrics-exporter

# ì •ìƒ ì¶œë ¥:
# âœ… Metrics server started: http://localhost:8000/metrics
# Simulating A/B test traffic...
# [0030s] Generated 60 metric updates
```

### 3ë‹¨ê³„: Prometheus Targets
```bash
# http://localhost:9090/targets

# metrics-exporterê°€ UP ìƒíƒœì—¬ì•¼ í•¨
```

### 4ë‹¨ê³„: ì§ì ‘ ë©”íŠ¸ë¦­ í™•ì¸
```bash
kubectl port-forward -n monitoring svc/metrics-exporter 8000:8000
curl http://localhost:8000/metrics | grep model_mae_score

# ì¶œë ¥ì´ ìˆì–´ì•¼ í•¨:
# model_mae_score{...} 0.42
```

### 5ë‹¨ê³„: ì „ì²´ ì¬ë°°í¬
```bash
# ëª¨ë“  ë¦¬ì†ŒìŠ¤ ì‚­ì œ
kubectl delete namespace monitoring

# ì¬ë°°í¬
./scripts/1_deploy_monitoring.sh
```

---

Â© 2024 í˜„ëŒ€ì˜¤í† ì—ë²„ MLOps Training  
**Version**: 3.0 ìµœì¢…ì™„ì „í•´ê²°íŒ  
**Date**: 2024-12-09  
**Status**: âœ… Production Ready - ëª¨ë“  ë¬¸ì œ í•´ê²° ì™„ë£Œ!
