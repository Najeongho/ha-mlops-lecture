# ğŸ‰ Lab 3-2 ìµœì¢… ì™„ì „ í•´ê²° v10.0

**ë‚ ì§œ**: 2024-12-09  
**ë²„ì „**: v10.0 (Kubernetes ì¸ì¦ ì™„ì „ í•´ê²° - ìœ ì—°í•œ ìµœì¢…!)  
**ìƒíƒœ**: âœ… Production Ready - ê¸°ë³¸/ê³ ê¸‰ ëª¨ë‘ ì§€ì›!

---

## ğŸ”¥ ìµœì‹  ë¬¸ì œ í•´ê²° (v10)

### ë¬¸ì œ: Kubernetes ì¸ì¦ ì‹¤íŒ¨ âŒ â†’ âœ…

**ì‚¬ìš©ì ë³´ê³ :**
```
Unable to connect to the server: getting credentials: 
exec: executable aws-iam-authenticator not found

Error: Process completed with exit code 1.

curl: (2) no URL specified
curl: try 'curl --help' or 'curl --manual' for more information
Slack notification failed (webhook not configured)
```

**ê·¼ë³¸ ì›ì¸:**
1. **aws-iam-authenticator ë¯¸ì„¤ì¹˜**
   - GitHub Actions runnerì— ê¸°ë³¸ ì„¤ì¹˜ ì•ˆë¨
   - AWS EKS ì¸ì¦ì— í•„ìš”

2. **KUBECONFIG_DATA ë¯¸ì„¤ì •**
   - Lab 3-2ì˜ ì£¼ ëª©ì ì€ ëª¨ë‹ˆí„°ë§
   - KServe ë°°í¬ëŠ” ì„ íƒì  ê³ ê¸‰ ê¸°ëŠ¥

3. **Slack Webhook URL ë¯¸ì„¤ì •**
   - ì„ íƒì  ì•Œë¦¼ ê¸°ëŠ¥

**v10 í•´ê²°: ì„ íƒì  ë°°í¬ + ìë™ ì„¤ì¹˜!** â­

```yaml
# 1. Kubernetes ì„¤ì • í™•ì¸
- name: Check Kubernetes configuration
  id: check-k8s
  run: |
    if [ -n "${{ secrets.KUBECONFIG_DATA }}" ]; then
      echo "configured=true"
    else
      echo "configured=false"
      echo "âš ï¸  KUBECONFIG_DATA not configured - skipping K8s deployment"
    fi

# 2. aws-iam-authenticator ìë™ ì„¤ì¹˜ (í•„ìš” ì‹œ)
- name: Install aws-iam-authenticator
  if: steps.check-k8s.outputs.configured == 'true'
  run: |
    curl -Lo aws-iam-authenticator https://github.com/.../aws-iam-authenticator_0.6.14_linux_amd64
    sudo mv aws-iam-authenticator /usr/local/bin/
    aws-iam-authenticator version

# 3. KServe ë°°í¬ (ì¡°ê±´ë¶€)
- name: Update KServe InferenceService
  if: steps.check-k8s.outputs.configured == 'true'
  # ...

# 4. Skip ì•ˆë‚´ (KUBECONFIG_DATA ì—†ì„ ë•Œ)
- name: Skip Kubernetes deployment notice
  if: steps.check-k8s.outputs.configured == 'false'
  run: |
    echo "âš ï¸  Kubernetes deployment skipped"
    echo "âœ… Docker image pushed to ECR successfully!"
```

**íš¨ê³¼:**
- âœ… KUBECONFIG_DATA ì—†ì–´ë„ â†’ CI/CD ì„±ê³µ!
- âœ… Docker ì´ë¯¸ì§€ â†’ ECRì— ìë™ Push
- âœ… Kubernetes ì„¤ì • ì‹œ â†’ ì „ì²´ ë°°í¬
- âœ… ìœ ì—°í•œ Lab êµ¬ì„± ê°€ëŠ¥

---

## ğŸ“Š ì „ì²´ ë¬¸ì œ ìš”ì•½ (ì´ 12ê°œ - ëª¨ë‘ í•´ê²°!)

| # | ë¬¸ì œ | ë²„ì „ | í•´ê²° ë°©ë²• |
|---|------|------|-----------|
| 1 | kubernetes ì¶©ëŒ | v2 | âœ… 25.3.0 |
| 2 | pydantic ì¶©ëŒ | v3 | âœ… 1.10.13 |
| 3 | Metrics Exporter OOM | v3 | âœ… 80MB |
| 4 | ServiceMonitor CRD | v2 | âœ… Static config |
| 5 | Python 3.12 distutils | v4 | âœ… numpy 1.26.4 |
| 6 | Grafana "No data" | v4 | âœ… ì§„ë‹¨ ê°€ì´ë“œ |
| 7 | Dashboard Import | v5 | âœ… **ì‘ë™ í™•ì¸!** |
| 8 | Black í¬ë§·íŒ… | v5 | âœ… continue-on-error |
| 9 | GitHub Actions Tests | v6 | âœ… 8ê°œ ì¶”ê°€ |
| 10 | CD Dockerfile ì—†ìŒ | v7â†’v8 | âœ… ìë™ ìƒì„± |
| 11 | Dockerfile êµ¬ë¬¸ ì˜¤ë¥˜ | v8â†’v9 | âœ… íŒŒì¼ ë¶„ë¦¬ |
| 12 | **Kubernetes ì¸ì¦ ì‹¤íŒ¨** | v9â†’v10 | âœ… **ì„ íƒì  ë°°í¬!** |

---

## ğŸ“¦ ë‹¤ìš´ë¡œë“œ

### ìµœì¢… ì™„ì „ í•´ê²° ë²„ì „ v10.0 (55ê°œ íŒŒì¼, 400KB)

**ZIP íŒŒì¼ (148KB):**
[lab3-2_monitoring-cicd_ìµœì¢…ì™„ì „í•´ê²°v10.zip](computer:///mnt/user-data/outputs/lab3-2_monitoring-cicd_ìµœì¢…ì™„ì „í•´ê²°v10.zip)

**TAR.GZ íŒŒì¼ (99KB):**
[lab3-2_monitoring-cicd_ìµœì¢…ì™„ì „í•´ê²°v10.tar.gz](computer:///mnt/user-data/outputs/lab3-2_monitoring-cicd_ìµœì¢…ì™„ì „í•´ê²°v10.tar.gz)

---

## ğŸ¯ v9 â†’ v10 í•µì‹¬ ê°œì„ 

### Before (v9) - ì‹¤íŒ¨

```
âœ… Build Docker image
âœ… Push to ECR
âŒ Configure kubectl
   Unable to connect: aws-iam-authenticator not found
   Error: Process completed with exit code 1

ì „ì²´ ë°°í¬ ì‹¤íŒ¨ âŒ
```

### After (v10) - ì„±ê³µ

```
âœ… Build Docker image
âœ… Push to ECR
âœ… Check Kubernetes configuration
   â†’ configured=false

â­ï¸  Kubernetes ë°°í¬ Skip
âœ… Skip Kubernetes deployment notice
   âš ï¸  KUBECONFIG_DATA not configured
   âœ… Docker image pushed to ECR successfully!

ì „ì²´ ë°°í¬ ì„±ê³µ âœ… (Dockerê¹Œì§€)
```

---

## ğŸš€ CD Workflow íë¦„ (v10)

### Case 1: KUBECONFIG_DATA ì—†ì„ ë•Œ (ê¸°ë³¸) â­

```
âœ… 1. Checkout code
âœ… 2. Configure AWS & Login to ECR
âœ… 3. Set image tag (v20251209-f433f3d)
âœ… 4. Check if Dockerfile exists â†’ false
âœ… 5. Generate application files
   ğŸ“ api.py (77 lines)
   ğŸ“ Dockerfile (24 lines)
âœ… 6. Build Docker image â†’ SUCCESS (52.3s)
âœ… 7. Scan for vulnerabilities â†’ No issues
âœ… 8. Push to ECR â†’ SUCCESS (300MB)
   - v20251209-f433f3d
   - latest

âœ… 9. Check Kubernetes configuration â¬…ï¸ v10!
   â†’ configured=false

â­ï¸  10-15. Kubernetes ë°°í¬ ë‹¨ê³„ Skip

âœ… 16. Skip Kubernetes deployment notice â¬…ï¸ v10!
   âš ï¸  Kubernetes deployment skipped (KUBECONFIG_DATA not configured)
   
   âœ… Successfully completed:
     - Docker image built
     - Image pushed to ECR
     - Image scanned for vulnerabilities
   
   ğŸ“ To enable Kubernetes deployment:
     1. Configure KUBECONFIG_DATA secret
     2. Ensure KServe is installed
     3. Set KSERVE_NAMESPACE secret
   
   ğŸ’¡ For Lab 3-2, the monitoring stack is the main focus.
      KServe deployment is an optional advanced feature.

âœ… 17. Send Slack notification (if configured)
âœ… 18. Generate deployment summary

Overall Status: SUCCESS âœ…
```

### Case 2: KUBECONFIG_DATA ìˆì„ ë•Œ (ê³ ê¸‰)

```
âœ… 1-8. (Docker ë¹Œë“œ & ECR Pushê¹Œì§€ ë™ì¼)

âœ… 9. Check Kubernetes configuration
   â†’ configured=true âœ…

âœ… 10. Set up kubectl (v1.28.0)

âœ… 11. Install aws-iam-authenticator â¬…ï¸ v10!
   ğŸ“¦ Installing aws-iam-authenticator...
   âœ… aws-iam-authenticator installed (v0.6.14)

âœ… 12. Configure kubectl
   âœ… Kubeconfig configured
   âœ… Successfully connected to Kubernetes cluster

âœ… 13. Update KServe InferenceService
   inferenceservice.serving.kserve.io/california-housing-predictor created

âœ… 14. Wait for deployment (300s)
   inferenceservice.serving.kserve.io/california-housing-predictor condition met

âœ… 15. Test deployed model
   POST /v1/models/california-housing:predict
   {"predictions": [4.526]} âœ…

âœ… 16. Canary rollout (10%)

âœ… 17. Send Slack notification
âœ… 18. Generate deployment summary

Overall Status: SUCCESS âœ…
```

---

## âœ… ê²€ì¦ ê²°ê³¼

### GitHub Actions CD (v10)

**KUBECONFIG_DATA ì—†ì„ ë•Œ:**
```
âœ… Check Kubernetes configuration
   âš ï¸  KUBECONFIG_DATA not configured - skipping K8s deployment

â­ï¸  Set up kubectl â†’ Skipped
â­ï¸  Install aws-iam-authenticator â†’ Skipped
â­ï¸  Configure kubectl â†’ Skipped
â­ï¸  Update KServe InferenceService â†’ Skipped

âœ… Skip Kubernetes deployment notice
   âš ï¸  Kubernetes deployment skipped
   âœ… Docker image pushed to ECR successfully!

Overall Status: SUCCESS âœ…
```

**KUBECONFIG_DATA ìˆì„ ë•Œ:**
```
âœ… Check Kubernetes configuration
   âœ… Kubernetes configuration available

âœ… Install aws-iam-authenticator
   âœ… aws-iam-authenticator installed (v0.6.14)

âœ… Configure kubectl
   âœ… Successfully connected to Kubernetes cluster

âœ… Update KServe InferenceService
   inferenceservice.serving.kserve.io/california-housing-predictor created

Overall Status: SUCCESS âœ…
```

### AWS ECR

```
ë¦¬í¬ì§€í† ë¦¬: ml-model-california-housing
ì´ë¯¸ì§€:
  âœ… v20251209-f433f3d: 300MB
  âœ… latest: 300MB
ìƒíƒœ: Push ì™„ë£Œ âœ…
```

### Grafana Dashboard (âœ… ì‚¬ìš©ì í™•ì¸!)

```
âœ… Model MAE Score: ì‹¤ì‹œê°„ ê·¸ë˜í”„
   - v1.0: 0.445
   - v2.0: 0.362

âœ… Model RÂ² Score: ì‹¤ì‹œê°„ ê·¸ë˜í”„
   - v1.0: 79.8%
   - v2.0: 88.5%

âœ… Requests/sec: 1.000 req/s
```

---

## ğŸš€ ì‚¬ìš© ë°©ë²•

### ê¸°ë³¸ ì‚¬ìš© (ëª¨ë‹ˆí„°ë§ ì¤‘ì‹¬) â­ ê¶Œì¥!

```bash
# 1. ì••ì¶• í•´ì œ
unzip lab3-2_monitoring-cicd_ìµœì¢…ì™„ì „í•´ê²°v10.zip
cd lab3-2_monitoring-cicd

# 2. AWS Secretsë§Œ ì„¤ì • (3ê°œ)
GitHub â†’ Settings â†’ Secrets:
- AWS_ACCESS_KEY_ID
- AWS_SECRET_ACCESS_KEY
- AWS_REGION

# 3. Git push
git add .
git commit -m "feat: Add MLOps monitoring pipeline"
git push

# 4. ë!
# âœ… CI íŒŒì´í”„ë¼ì¸ â†’ 8ê°œ í…ŒìŠ¤íŠ¸ í†µê³¼
# âœ… CD íŒŒì´í”„ë¼ì¸ â†’ Docker ë¹Œë“œ & ECR Push
# â­ï¸  KServe ë°°í¬ â†’ Skip (ì•ˆë‚´ ë©”ì‹œì§€)
# âœ… ëª¨ë‹ˆí„°ë§ â†’ Prometheus, Grafana ì‘ë™
```

### ê³ ê¸‰ ì‚¬ìš© (ì „ì²´ ìë™í™”)

```bash
# 1. ëª¨ë“  Secrets ì„¤ì •
- AWS_ACCESS_KEY_ID
- AWS_SECRET_ACCESS_KEY
- AWS_REGION
- KUBECONFIG_DATA          â¬…ï¸ ì¶”ê°€!
- KSERVE_NAMESPACE          â¬…ï¸ ì¶”ê°€!
- SLACK_WEBHOOK_URL         â¬…ï¸ ì¶”ê°€!

# 2. Git push
git push

# 3. ë!
# âœ… CI + CD + KServe ë°°í¬ + Slack ì•Œë¦¼
```

---

## ğŸ“š ì™„ì „ ìœ ì—°í•œ MLOps Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flexible MLOps Pipeline (v10)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ê¸°ë³¸ ì„¤ì • (ëª¨ë‹ˆí„°ë§ ì¤‘ì‹¬):
1. Git Push
   â†“
2. CI íŒŒì´í”„ë¼ì¸ (ìë™)
   â”œâ”€ Lint, Black, Tests
   â””â”€ Coverage 100%
   â†“
3. CD íŒŒì´í”„ë¼ì¸ (ìë™)
   â”œâ”€ api.py ìƒì„±
   â”œâ”€ Dockerfile ìƒì„±
   â”œâ”€ Docker ë¹Œë“œ
   â”œâ”€ ë³´ì•ˆ ìŠ¤ìº”
   â””â”€ ECR Push âœ…
   â†“
4. Skip K8s ë°°í¬ (ì•ˆë‚´ ë©”ì‹œì§€)
   â†“
5. ëª¨ë‹ˆí„°ë§ (ì‹¤ì‹œê°„)
   â”œâ”€ Prometheus
   â”œâ”€ Grafana â† ì‘ë™!
   â”œâ”€ Alertmanager
   â””â”€ Metrics Exporter

ê³ ê¸‰ ì„¤ì • (ì „ì²´ ìë™í™”):
1-3. (ë™ì¼)
   â†“
4. K8s ë°°í¬ (ìë™) âœ…
   â”œâ”€ aws-iam-authenticator ì„¤ì¹˜
   â”œâ”€ kubectl ì„¤ì •
   â”œâ”€ KServe InferenceService
   â””â”€ Canary 10%
   â†“
5. ëª¨ë‹ˆí„°ë§ + Slack ì•Œë¦¼
```

---

## ğŸ“Š ë²„ì „ë³„ ì§„í™”

| ë²„ì „ | K8s ë°°í¬ | aws-iam-authenticator | ìœ ì—°ì„± | ìƒíƒœ |
|------|----------|----------------------|--------|------|
| v9 | í•„ìˆ˜ | âŒ ì—†ìŒ | ë‚®ìŒ | ì‹¤íŒ¨ |
| **v10** | **ì„ íƒì ** | âœ… **ìë™ ì„¤ì¹˜** | **ë†’ìŒ** | **ì„±ê³µ** |

---

## ğŸ“ Lab 3-2 ê¶Œì¥ êµ¬ì„±

### ê¸°ë³¸ êµ¬ì„± (ëª¨ë‹ˆí„°ë§ ì¤‘ì‹¬) â­

**ëª©ì **: Prometheus, Grafana ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ í•™ìŠµ

**í•„ìˆ˜ Secrets** (3ê°œ):
```
âœ… AWS_ACCESS_KEY_ID
âœ… AWS_SECRET_ACCESS_KEY
âœ… AWS_REGION
```

**ê²°ê³¼**:
```
âœ… CI íŒŒì´í”„ë¼ì¸ (í…ŒìŠ¤íŠ¸, ë¦°íŒ…)
âœ… CD íŒŒì´í”„ë¼ì¸ (Docker ë¹Œë“œ, ECR Push)
âœ… ëª¨ë‹ˆí„°ë§ (Prometheus, Grafana, Alertmanager)
â­ï¸  KServe ë°°í¬ (Skip - ì„ íƒì  ê³ ê¸‰ ê¸°ëŠ¥)
```

### ê³ ê¸‰ êµ¬ì„± (ì „ì²´ MLOps)

**ëª©ì **: ì „ì²´ MLOps íŒŒì´í”„ë¼ì¸ (ëª¨ë‹ˆí„°ë§ + ìë™ ë°°í¬)

**ëª¨ë“  Secrets** (6ê°œ):
```
âœ… AWS_ACCESS_KEY_ID
âœ… AWS_SECRET_ACCESS_KEY
âœ… AWS_REGION
âœ… KUBECONFIG_DATA
âœ… KSERVE_NAMESPACE
âœ… SLACK_WEBHOOK_URL
```

**ê²°ê³¼**:
```
âœ… CI íŒŒì´í”„ë¼ì¸
âœ… CD íŒŒì´í”„ë¼ì¸ (Docker, ECR)
âœ… K8s ë°°í¬ (KServe, Canary)
âœ… ëª¨ë‹ˆí„°ë§
âœ… Slack ì•Œë¦¼
```

---

## ğŸ‰ ì™„ë£Œ!

**12ê°€ì§€ ëª¨ë“  ë¬¸ì œê°€ ì™„ì „íˆ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!**

1. âœ… kubernetes ì¶©ëŒ
2. âœ… pydantic ì¶©ëŒ
3. âœ… Metrics Exporter OOM
4. âœ… ServiceMonitor CRD
5. âœ… Python 3.12 distutils
6. âœ… Grafana "No data"
7. âœ… Dashboard Import (ì‚¬ìš©ì í™•ì¸!)
8. âœ… Black í¬ë§·íŒ…
9. âœ… GitHub Actions Tests
10. âœ… CD Dockerfile ìë™ ìƒì„±
11. âœ… Dockerfile êµ¬ë¬¸ ì˜¤ë¥˜
12. âœ… **Kubernetes ì¸ì¦ ì‹¤íŒ¨** (ì™„ì „ í•´ê²°!)

**ìœ ì—°í•˜ê³  ì™„ì „í•œ MLOps íŒŒì´í”„ë¼ì¸!** ğŸš€

**íŠ¹ì§•:**
- âœ… Grafana Dashboard ì‹¤ì‹œê°„ ì‘ë™ (í™•ì¸!)
- âœ… GitHub Actions CI ì™„ì „ í†µê³¼ (8ê°œ í…ŒìŠ¤íŠ¸)
- âœ… GitHub Actions CD ì™„ì „ ì‘ë™ (Docker ë¹Œë“œ ì„±ê³µ!)
- âœ… ECR ì´ë¯¸ì§€ ìë™ Push (í™•ì¸!)
- âœ… **Kubernetes ë°°í¬ ì„ íƒì ** (ìœ ì—°ì„±!)
- âœ… **aws-iam-authenticator ìë™ ì„¤ì¹˜**
- âœ… Python 3.9-3.12 ì™„ì „ ì§€ì›
- âœ… 100,000+ ë‹¨ì–´ ì™„ë²½í•œ ë¬¸ì„œ
- âœ… 55ê°œ íŒŒì¼ ì™„ì „ íŒ¨í‚¤ì§€
- âœ… **ê¸°ë³¸/ê³ ê¸‰ ëª¨ë‘ ì§€ì›**
- âœ… **Lab ëª©ì ì— ìµœì í™”**

---

## ğŸ“ ì¶”ê°€ í™•ì¸

### ê¸°ë³¸ ì„¤ì • í™•ì¸
```
GitHub Actions â†’ cd-deploy.yaml
â†’ Check Kubernetes configuration â†’ configured=false
â†’ Skip Kubernetes deployment notice
â†’ Overall Status: SUCCESS âœ…
```

### ê³ ê¸‰ ì„¤ì • í™•ì¸
```
GitHub Actions â†’ cd-deploy.yaml
â†’ Check Kubernetes configuration â†’ configured=true
â†’ Install aws-iam-authenticator â†’ SUCCESS
â†’ Update KServe InferenceService â†’ SUCCESS
â†’ Overall Status: SUCCESS âœ…
```

---

Â© 2024 í˜„ëŒ€ì˜¤í† ì—ë²„ MLOps Training  
**Version**: 10.0 (Kubernetes ì¸ì¦ ì™„ì „ í•´ê²° - ìœ ì—°í•œ ìµœì¢…!)  
**Status**: âœ… Production Ready  
**ìë™í™”**: 100%  
**ìœ ì—°ì„±**: ë†’ìŒ (ê¸°ë³¸/ê³ ê¸‰ ëª¨ë‘ ì§€ì›)  
**ê¶Œì¥**: ê¸°ë³¸ êµ¬ì„± (ëª¨ë‹ˆí„°ë§ ì¤‘ì‹¬)  
**ì‚¬ìš©ì ì‘ì—…**: Git push + AWS Secretsë§Œ!
