# Lab 3-1: Prometheus/Grafana ëª¨ë‹ˆí„°ë§

## ğŸ“‹ ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì†Œìš”ì‹œê°„** | 40ë¶„ |
| **ë‚œì´ë„** | â­â­ |
| **ëª©í‘œ** | Grafana ëŒ€ì‹œë³´ë“œë¡œ ML ëª¨ë¸ ì„œë¹™ ëª¨ë‹ˆí„°ë§ |

## ğŸ¯ í•™ìŠµ ëª©í‘œ

- Prometheus ë©”íŠ¸ë¦­ ì´í•´
- Grafana ëŒ€ì‹œë³´ë“œ íƒìƒ‰
- KServe ë©”íŠ¸ë¦­ ëª¨ë‹ˆí„°ë§
- ì•Œë¦¼ ê·œì¹™ ì„¤ì •

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Monitoring Architecture                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ KServe  â”‚â”€â”€â”€â”€â–¶â”‚ Prometheus  â”‚â”€â”€â”€â”€â–¶â”‚  Grafana    â”‚       â”‚
â”‚  â”‚ /metricsâ”‚     â”‚   (TSDB)    â”‚     â”‚ (Dashboard) â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚       â”‚                â”‚                    â”‚               â”‚
â”‚       â”‚                â”‚                    â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ FastAPI â”‚â”€â”€â”€â”€â–¶â”‚ AlertManagerâ”‚â”€â”€â”€â”€â–¶â”‚   Slack     â”‚       â”‚
â”‚  â”‚ /metricsâ”‚     â”‚             â”‚     â”‚   Email     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
lab3-1_monitoring/
â”œâ”€â”€ README.md
â”œâ”€â”€ grafana-access.sh           # Grafana ì ‘ì† ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ prometheus-queries.md       # PromQL ì¿¼ë¦¬ ëª¨ìŒ
â””â”€â”€ alert-rules.yaml           # ì•Œë¦¼ ê·œì¹™ ì˜ˆì‹œ
```

## ğŸ”§ ì‹¤ìŠµ ë‹¨ê³„

### Step 1: Grafana ì ‘ì†

```bash
# í¬íŠ¸ í¬ì›Œë”©
kubectl port-forward svc/grafana -n monitoring 3000:3000

# ë¸Œë¼ìš°ì € ì ‘ì†
http://localhost:3000

# ë¡œê·¸ì¸
Username: admin
Password: [ì œê³µëœ ë¹„ë°€ë²ˆí˜¸]
```

### Step 2: ëŒ€ì‹œë³´ë“œ íƒìƒ‰

1. ì¢Œì¸¡ ë©”ë‰´ â†’ **Dashboards** â†’ **Browse**
2. ë‹¤ìŒ ëŒ€ì‹œë³´ë“œ í™•ì¸:
   - Kubernetes / Compute Resources / Namespace (Pods)
   - Kubernetes / Networking / Namespace (Pods)

### Step 3: PromQL ì¿¼ë¦¬ ì‹¤ìŠµ

ì¢Œì¸¡ ë©”ë‰´ â†’ **Explore** â†’ Prometheus ì„ íƒ

```promql
# Pod CPU ì‚¬ìš©ëŸ‰
sum(rate(container_cpu_usage_seconds_total{namespace="kubeflow-userXX"}[5m])) by (pod)

# Pod Memory ì‚¬ìš©ëŸ‰
sum(container_memory_usage_bytes{namespace="kubeflow-userXX"}) by (pod)

# KServe ìš”ì²­ ìˆ˜ (ìˆëŠ” ê²½ìš°)
rate(revision_request_count[1m])
```

### Step 4: ëŒ€ì‹œë³´ë“œ ìƒì„± (ì„ íƒ)

1. ì¢Œì¸¡ ë©”ë‰´ â†’ **Create** â†’ **Dashboard**
2. **Add visualization** í´ë¦­
3. Prometheus ë°ì´í„°ì†ŒìŠ¤ ì„ íƒ
4. PromQL ì¿¼ë¦¬ ì…ë ¥
5. ì €ì¥

## âœ… ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Grafana ë¡œê·¸ì¸ ì„±ê³µ
- [ ] ê¸°ë³¸ ëŒ€ì‹œë³´ë“œ íƒìƒ‰
- [ ] Exploreì—ì„œ PromQL ì‹¤í–‰
- [ ] ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë¦¬ì†ŒìŠ¤ í™•ì¸

## ğŸ“Š ì£¼ìš” ë©”íŠ¸ë¦­

### ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­

| ë©”íŠ¸ë¦­ | ì„¤ëª… | PromQL |
|--------|------|--------|
| CPU ì‚¬ìš©ëŸ‰ | Pod CPU ì‚¬ìš©ë¥  | `rate(container_cpu_usage_seconds_total[5m])` |
| Memory ì‚¬ìš©ëŸ‰ | Pod ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ | `container_memory_usage_bytes` |
| Network I/O | ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ | `rate(container_network_*[5m])` |

### ì„œë¹„ìŠ¤ ë©”íŠ¸ë¦­ (KServe)

| ë©”íŠ¸ë¦­ | ì„¤ëª… |
|--------|------|
| request_count | ìš”ì²­ ìˆ˜ |
| request_latency | ì‘ë‹µ ì§€ì—°ì‹œê°„ |
| request_bytes | ìš”ì²­ í¬ê¸° |

## â“ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ: "Connection refused"

```bash
# Grafana Pod ìƒíƒœ í™•ì¸
kubectl get pods -n monitoring | grep grafana

# ë¡œê·¸ í™•ì¸
kubectl logs -l app.kubernetes.io/name=grafana -n monitoring
```

### ë¬¸ì œ: "No data" in dashboard

1. ë°ì´í„°ì†ŒìŠ¤ ì—°ê²° í™•ì¸: Settings â†’ Data Sources â†’ Prometheus
2. ì‹œê°„ ë²”ìœ„ í™•ì¸ (ìš°ì¸¡ ìƒë‹¨)
3. ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë³€ìˆ˜ í™•ì¸

## ğŸ“š ì°¸ê³  ìë£Œ

- [Prometheus ë¬¸ì„œ](https://prometheus.io/docs/)
- [Grafana ë¬¸ì„œ](https://grafana.com/docs/)
- [PromQL ê¸°ì´ˆ](https://prometheus.io/docs/prometheus/latest/querying/basics/)
